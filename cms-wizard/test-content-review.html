<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>콘텐츠 저장 및 리뷰 테스트 - 이화여자대학교</title>
    
    <!-- 메인 앱과 동일한 JavaScript 의존성 추가 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/motion@10.16.2/dist/motion.min.js"></script>
    <script src="assets/js/performance-utils.js"></script>
    <script src="assets/js/content-storage.js"></script>
    <script src="assets/js/jsp-content-storage.js"></script>
    <script src="assets/js/api-interface.js"></script>
    <script src="assets/js/cms-integration.js"></script>
    <script src="assets/js/ai-simulator.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            background-color: #f9fafb;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        h1, h2 {
            color: #1f2937;
            margin-bottom: 1rem;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
        }
        
        .card h3 {
            font-size: 1rem;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .card p {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }
        
        .status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status.waiting {
            background-color: #f3f4f6;
            color: #6b7280;
        }
        
        .status.processing {
            background-color: #dbeafe;
            color: #3b82f6;
        }
        
        .status.completed {
            background-color: #d1fae5;
            color: #059669;
        }
        
        .status.error {
            background-color: #fee2e2;
            color: #dc2626;
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .btn-secondary {
            background-color: #f3f4f6;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background-color: #e5e7eb;
        }
        
        .btn-danger {
            background-color: #dc2626;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #b91c1c;
        }
        
        .stats {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #3b82f6;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .log-container {
            background: #1f2937;
            color: #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        .log-entry {
            margin-bottom: 0.25rem;
        }
        
        .log-entry.success {
            color: #10b981;
        }
        
        .log-entry.error {
            color: #ef4444;
        }
        
        .log-entry.warning {
            color: #f59e0b;
        }
        
        .log-entry.info {
            color: #3b82f6;
        }
        
        .iframe-container {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            height: 500px;
        }
        
        #preview-frame {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>콘텐츠 저장 및 리뷰 테스트</h1>
        <p>이화여자대학교 템플릿을 사용한 AI 콘텐츠 생성 시뮬레이션</p>
        
        <div class="controls">
            <button class="btn-primary" id="btn-start">생성 시뮬레이션 시작</button>
            <button class="btn-secondary" id="btn-stop">중지</button>
            <button class="btn-secondary" id="btn-review">리뷰 모드</button>
            <button class="btn-secondary" id="btn-debug">저장소 디버그</button>
            <button class="btn-danger" id="btn-clear">모두 초기화</button>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="completed-pages">0</div>
                <div class="stat-label">완료된 페이지</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="stored-content">0</div>
                <div class="stat-label">저장된 콘텐츠</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="reviewable">0</div>
                <div class="stat-label">리뷰 가능</div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2>콘텐츠 현황</h2>
        <div class="grid" id="content-grid">
            <!-- 동적으로 생성됨 -->
        </div>
    </div>
    
    <div class="container">
        <h2>실행 로그</h2>
        <div class="log-container" id="simulation-log">
            <!-- 로그가 여기에 표시됩니다 -->
        </div>
    </div>
    
    <div class="container">
        <h2>미리보기</h2>
        <div class="iframe-container">
            <iframe id="preview-frame" src="about:blank"></iframe>
        </div>
    </div>

    <script>
        // 전역 변수들
        let storage = null;
        let simulationInterval = null;
        let currentIndex = 0;
        
        // 메인 앱의 AI Simulator 인스턴스와 콘텐츠 데이터베이스 사용
        let aiSimulator = null;
        let mainContentDatabase = null;
        
        // 메뉴 데이터
        const menuData = {
            menus: [
                {
                    id: 'about',
                    title: 'About',
                    koreanTitle: '대학소개',
                    submenus: [
                        { id: 'welcome', title: 'Welcome Message', koreanTitle: '환영 메시지' },
                        { id: 'company', title: 'Company Overview', koreanTitle: '회사 개요' },
                        { id: 'mission', title: 'Mission & Vision', koreanTitle: '미션 & 비전' }
                    ]
                },
                {
                    id: 'research',
                    title: 'Research',
                    koreanTitle: '연구',
                    submenus: [
                        { id: 'areas', title: 'Research Areas', koreanTitle: '연구 분야' },
                        { id: 'projects', title: 'Current Projects', koreanTitle: '진행 프로젝트' },
                        { id: 'publications', title: 'Publications', koreanTitle: '연구 성과' }
                    ]
                },
                {
                    id: 'services',
                    title: 'Services',
                    koreanTitle: '학사',
                    submenus: [
                        { id: 'consulting', title: 'Consulting Services', koreanTitle: '컨설팅 서비스' },
                        { id: 'development', title: 'Development Services', koreanTitle: '개발 서비스' },
                        { id: 'support', title: 'Support Services', koreanTitle: '지원 서비스' }
                    ]
                }
            ]
        };
        
        // 메인 앱과 동일한 콘텐츠 데이터베이스 가져오기
        function initializeMainAppData() {
            try {
                // AISimulator 인스턴스 생성 (메인 앱과 동일)
                aiSimulator = new AISimulator(null); // app은 null로 설정 (테스트 환경)
                mainContentDatabase = aiSimulator.contentDatabase;
                
                console.log('✅ 메인 앱 데이터 초기화 완료:', mainContentDatabase);
                addLog('✅ 메인 앱 데이터 초기화 완료', 'success');
                return mainContentDatabase;
            } catch (error) {
                console.error('❌ 메인 앱 데이터 초기화 실패:', error);
                addLog('❌ 메인 앱 데이터 초기화 실패: ' + error.message, 'error');
                return null;
            }
        }

        // 실제 콘텐츠 데이터 가져오기 (메인 앱과 동일한 데이터베이스 사용)
        function getRealContentData(menuId, submenuId) {
            if (!mainContentDatabase) {
                initializeMainAppData();
            }
            
            const contentData = mainContentDatabase[menuId]?.[submenuId];
            console.log(`🔍 메인 앱 콘텐츠 데이터 조회: ${menuId}/${submenuId}`, contentData);
            
            // 메인 앱 데이터가 있으면 return, 없으면 기본값 반환
            if (contentData) {
                return contentData;
            }
            
            return {
                title: '페이지 제목',
                subtitle: '페이지 부제목',
                content: ['기본 콘텐츠입니다.'],
                features: [
                    { title: '기본 기능', desc: '기본 설명', icon: '📋' }
                ]
            };
        }
        
        // 템플릿 HTML 생성 (메인 앱 PreviewManager와 동일한 템플릿)
        function generateEwhaTemplate(menu, submenu, contentData) {
            // 메인 앱의 PreviewManager.createTemplateContent와 동일한 구조 사용
            const pageTitle = contentData.title;
            
            function formatMainContent(content) {
                if (typeof content === 'string') {
                    return `<p>${content}</p>`;
                }
                
                if (Array.isArray(content)) {
                    return content.map(paragraph => `<p>${paragraph}</p>`).join('');
                }
                
                return `<p>${content || '콘텐츠가 생성되지 않았습니다.'}</p>`;
            }
            
            return `
            <!DOCTYPE html>
            <html lang="ko">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>${pageTitle}</title>
                <style>
                    * {
                        margin: 0;
                        padding: 0;
                        box-sizing: border-box;
                    }
                    
                    body {
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        line-height: 1.6;
                        color: #333;
                        background: #f5f5f5;
                    }
                    
                    .header {
                        background: #fff;
                        padding: 20px 0;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        position: sticky;
                        top: 0;
                        z-index: 100;
                    }
                    
                    .container {
                        max-width: 1200px;
                        margin: 0 auto;
                        padding: 0 20px;
                    }
                    
                    .nav {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    
                    .logo {
                        font-size: 18px;
                        font-weight: bold;
                        color: #166534;
                        display: flex;
                        align-items: center;
                    }
                    
                    .nav-menu {
                        display: flex;
                        list-style: none;
                        gap: 30px;
                    }
                    
                    .nav-menu a {
                        text-decoration: none;
                        color: #666;
                        transition: color 0.3s;
                    }
                    
                    .nav-menu a:hover {
                        color: #166534;
                    }
                    
                    .hero {
                        background: linear-gradient(135deg, #166534 0%, #15803d 100%);
                        color: white;
                        padding: 80px 0;
                        text-align: center;
                    }
                    
                    .hero h1 {
                        font-size: 48px;
                        margin-bottom: 20px;
                        opacity: 0;
                        animation: fadeInUp 0.8s ease forwards;
                    }
                    
                    .hero p {
                        font-size: 20px;
                        opacity: 0;
                        animation: fadeInUp 0.8s ease 0.2s forwards;
                    }
                    
                    .content {
                        padding: 60px 0;
                        background: white;
                    }
                    
                    .breadcrumb {
                        display: flex;
                        gap: 8px;
                        font-size: 14px;
                        color: #666;
                        margin-bottom: 30px;
                        align-items: center;
                    }
                    
                    .breadcrumb span:last-child {
                        color: #166534;
                        font-weight: 500;
                    }
                    
                    .content h2 {
                        font-size: 36px;
                        margin-bottom: 30px;
                        color: #333;
                    }
                    
                    .content p {
                        font-size: 18px;
                        color: #666;
                        margin-bottom: 20px;
                        line-height: 1.8;
                    }
                    
                    .placeholder-text {
                        background: #f0f0f0;
                        padding: 4px 8px;
                        border-radius: 4px;
                        display: inline-block;
                        margin: 2px;
                        transition: all 0.3s ease;
                    }
                    
                    .ai-generating {
                        animation: pulse 1s ease infinite;
                    }
                    
                    @keyframes fadeInUp {
                        from {
                            opacity: 0;
                            transform: translateY(20px);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }
                    
                    @keyframes pulse {
                        0%, 100% {
                            opacity: 0.5;
                        }
                        50% {
                            opacity: 1;
                        }
                    }
                    
                    .grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                        gap: 30px;
                        margin-top: 40px;
                    }
                    
                    .card {
                        background: #f8f9fa;
                        padding: 30px;
                        border-radius: 10px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        transition: transform 0.3s;
                    }
                    
                    .card:hover {
                        transform: translateY(-5px);
                    }
                    
                    .card h3 {
                        margin-bottom: 15px;
                        color: #333;
                    }
                    
                    .image-placeholder {
                        width: 100%;
                        height: 300px;
                        background: linear-gradient(45deg, #f0f0f0 25%, #e0e0e0 25%, #e0e0e0 50%, #f0f0f0 50%, #f0f0f0 75%, #e0e0e0 75%, #e0e0e0);
                        background-size: 20px 20px;
                        border-radius: 8px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: #999;
                        font-size: 18px;
                        margin: 20px 0;
                    }
                    
                    /* Generated Content Banner */
                    .generated-banner {
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white;
                        padding: 8px 0;
                        text-align: center;
                        font-size: 0.875rem;
                        font-weight: 500;
                        position: sticky;
                        top: 0;
                        z-index: 200;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                    }
                    
                    .generated-banner .icon {
                        margin-right: 8px;
                    }
                    
                    /* Header */
                    .header {
                        background: #ffffff;
                        border-bottom: 1px solid #e5e7eb;
                        position: sticky;
                        top: 32px;
                        z-index: 100;
                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                    }
                    
                    .header-inner {
                        max-width: 1440px;
                        margin: 0 auto;
                        padding: 0 2rem;
                        height: 64px;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                    }
                    
                    .logo {
                        display: flex;
                        align-items: center;
                        gap: 0.75rem;
                        font-size: 1.25rem;
                        font-weight: 700;
                        color: #1f2937;
                    }
                    
                    .logo svg {
                        width: 32px;
                        height: 32px;
                    }
                    
                    .nav-menu {
                        display: flex;
                        gap: 2rem;
                        list-style: none;
                    }
                    
                    .nav-menu a {
                        color: #4b5563;
                        text-decoration: none;
                        font-weight: 500;
                        transition: color 0.2s;
                        position: relative;
                    }
                    
                    .nav-menu a:hover {
                        color: #6366f1;
                    }
                    
                    .nav-menu a.active {
                        color: #6366f1;
                        font-weight: 600;
                    }
                    
                    .nav-menu a.active::after {
                        content: '';
                        position: absolute;
                        bottom: -16px;
                        left: 50%;
                        transform: translateX(-50%);
                        width: 24px;
                        height: 2px;
                        background: #6366f1;
                    }
                    
                    /* Hero Section */
                    .hero {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 4rem 0;
                        text-align: center;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .hero-content {
                        position: relative;
                        z-index: 1;
                        max-width: 800px;
                        margin: 0 auto;
                        padding: 0 2rem;
                    }
                    
                    .hero h1 {
                        font-size: 3rem;
                        margin-bottom: 1.5rem;
                        font-weight: 700;
                        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
                    }
                    
                    .hero .subtitle {
                        font-size: 1.25rem;
                        opacity: 0.9;
                        font-weight: 400;
                    }
                    
                    /* Main Content */
                    .main-content {
                        flex: 1;
                        background: white;
                        padding: 4rem 0;
                    }
                    
                    .breadcrumb {
                        display: flex;
                        gap: 0.5rem;
                        font-size: 0.875rem;
                        color: #6b7280;
                        margin-bottom: 2rem;
                    }
                    
                    .breadcrumb span {
                        color: #d1d5db;
                    }
                    
                    .breadcrumb a {
                        color: #6b7280;
                        text-decoration: none;
                    }
                    
                    .breadcrumb a:hover {
                        color: #6366f1;
                    }
                    
                    .content-section {
                        margin-bottom: 3rem;
                    }
                    
                    .content-section h2 {
                        font-size: 2rem;
                        font-weight: 600;
                        color: #1f2937;
                        margin-bottom: 1.5rem;
                    }
                    
                    .main-content-text p {
                        font-size: 1.125rem;
                        color: #4b5563;
                        line-height: 1.8;
                        margin-bottom: 1.5rem;
                    }
                    
                    .features-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                        gap: 2rem;
                        margin-top: 3rem;
                    }
                    
                    .feature-card {
                        background: #f8fafc;
                        padding: 2rem;
                        border-radius: 12px;
                        border: 1px solid #e2e8f0;
                        transition: all 0.3s ease;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .feature-card::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        height: 4px;
                        background: linear-gradient(135deg, #10b981, #059669);
                    }
                    
                    .feature-card:hover {
                        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
                        transform: translateY(-5px);
                    }
                    
                    .feature-card h3 {
                        font-size: 1.25rem;
                        font-weight: 600;
                        color: #1f2937;
                        margin-bottom: 1rem;
                        display: flex;
                        align-items: center;
                        gap: 0.5rem;
                    }
                    
                    .feature-icon {
                        width: 24px;
                        height: 24px;
                        background: #10b981;
                        border-radius: 6px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-size: 12px;
                    }
                    
                    .feature-card p {
                        color: #6b7280;
                        line-height: 1.6;
                        font-size: 1rem;
                    }
                    
                    /* Generation Info */
                    .generation-info {
                        background: linear-gradient(135deg, #ede9fe 0%, #e0e7ff 100%);
                        border: 1px solid #c4b5fd;
                        border-radius: 12px;
                        padding: 2rem;
                        margin: 3rem 0;
                    }
                    
                    .generation-info h3 {
                        color: #5b21b6;
                        font-size: 1.25rem;
                        margin-bottom: 1rem;
                    }
                    
                    .info-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 1rem;
                    }
                    
                    .info-item {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 0.5rem 0;
                        border-bottom: 1px solid rgba(139, 92, 246, 0.2);
                    }
                    
                    .info-item:last-child {
                        border-bottom: none;
                    }
                    
                    .info-item .label {
                        font-weight: 500;
                        color: #6b46c1;
                    }
                    
                    .info-item .value {
                        font-weight: 600;
                        color: #5b21b6;
                    }
                    
                    /* Footer */
                    .footer {
                        background: #1f2937;
                        color: #d1d5db;
                        padding: 3rem 0 2rem;
                        margin-top: auto;
                    }
                    
                    .footer-content {
                        max-width: 1200px;
                        margin: 0 auto;
                        padding: 0 2rem;
                        text-align: center;
                    }
                    
                    .footer p {
                        font-size: 0.875rem;
                        opacity: 0.8;
                    }
                    
                    /* Real Content Indicator */
                    .real-content-indicator {
                        position: fixed;
                        top: 50%;
                        right: 20px;
                        transform: translateY(-50%);
                        background: rgba(16, 185, 129, 0.9);
                        color: white;
                        padding: 12px 16px;
                        border-radius: 50px;
                        font-size: 0.875rem;
                        font-weight: 500;
                        z-index: 1000;
                        backdrop-filter: blur(8px);
                        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    }
                </style>
            </head>
            <body>
                <header class="header">
                    <div class="container">
                        <nav class="nav">
                            <div class="logo">
                                <img src="data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='18' fill='%23166534' stroke='%23ffffff' stroke-width='2'/%3E%3Ctext x='20' y='25' text-anchor='middle' fill='white' font-size='12' font-weight='bold'%3E이화%3C/text%3E%3C/svg%3E" alt="이화여대" style="width: 40px; height: 40px; margin-right: 12px;">
                                이화여자대학교 사회복지학과
                            </div>
                            <ul class="nav-menu">
                                <li><a href="/about">학과소개</a></li>
                                <li><a href="/research">학사정보</a></li>
                                <li><a href="/services">입학정보</a></li>
                                <li><a href="/team">학생활동</a></li>
                                <li><a href="/portfolio">자료실</a></li>
                                <li><a href="/news">커뮤니티</a></li>
                            </ul>
                        </nav>
                    </div>
                </header>
                
                <section class="hero">
                    <div class="container">
                        <h1 class="page-title">${pageTitle}</h1>
                        <p class="page-subtitle">
                            ${contentData.subtitle || 'AI가 콘텐츠를 생성하고 있습니다...'}
                        </p>
                    </div>
                </section>
                
                <section class="content">
                    <div class="container">
                        <div class="breadcrumb">
                            <span>🏠 홈</span>
                            <span>›</span>
                            <span>학과소개</span>
                            <span>›</span>
                            <span>인사말</span>
                        </div>
                        <h2>개요</h2>
                        ${formatMainContent(contentData.content)}
                        
                        <div class="image-placeholder">
                            <span>Image will be generated here</span>
                        </div>
                        
                        ${contentData.features && contentData.features.length > 0 ? `
                        <div class="grid">
                            ${contentData.features.map(feature => `
                                <div class="card">
                                    <h3>${feature.title}</h3>
                                    <p>${feature.description || feature.desc}</p>
                                </div>
                            `).join('')}
                        </div>
                        ` : `
                        <div class="grid">
                            <div class="card">
                                <h3><span class="placeholder-text">Feature 1</span></h3>
                                <p>
                                    <span class="placeholder-text">Description text</span>
                                    <span class="placeholder-text">will be generated</span>
                                </p>
                            </div>
                            <div class="card">
                                <h3><span class="placeholder-text">Feature 2</span></h3>
                                <p>
                                    <span class="placeholder-text">Description text</span>
                                    <span class="placeholder-text">will be generated</span>
                                </p>
                            </div>
                            <div class="card">
                                <h3><span class="placeholder-text">Feature 3</span></h3>
                                <p>
                                    <span class="placeholder-text">Description text</span>
                                    <span class="placeholder-text">will be generated</span>
                                </p>
                            </div>
                        </div>
                        `}
                    </div>
                </section>
            </body>
            </html>
        `;
        }
        
        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 테스트 페이지 초기화 시작');
            addLog('🚀 테스트 페이지 초기화 시작', 'info');
            
            // 메인 앱 데이터 초기화
            initializeMainAppData();
            
            // ContentStorage 초기화
            try {
                storage = new ContentStorage();
                addLog('✅ ContentStorage 초기화 완료', 'success');
            } catch (error) {
                addLog('❌ ContentStorage 초기화 실패: ' + error.message, 'error');
            }
            
            // 이벤트 리스너 설정
            document.getElementById('btn-start').addEventListener('click', startSimulation);
            document.getElementById('btn-stop').addEventListener('click', stopSimulation);
            document.getElementById('btn-review').addEventListener('click', enterReviewMode);
            document.getElementById('btn-debug').addEventListener('click', showStorageDebug);
            document.getElementById('btn-clear').addEventListener('click', clearAll);
            
            // 초기 UI 업데이트
            updateContentGrid();
            updateStats();
            
            addLog('✅ 초기화 완료', 'success');
        });
        
        // 시뮬레이션 시작
        function startSimulation() {
            console.log('🚀 startSimulation 함수 호출됨');
            addLog('🚀 startSimulation 함수 호출됨', 'info');
            
            if (simulationInterval) {
                console.log('⚠️ 이미 시뮬레이션이 진행 중');
                addLog('이미 시뮬레이션이 진행 중입니다', 'warning');
                return;
            }
            
            if (!storage) {
                console.error('❌ Storage가 초기화되지 않음');
                addLog('❌ Storage가 초기화되지 않았습니다', 'error');
                return;
            }
            
            console.log('✅ 시뮬레이션 시작 조건 확인 완료');
            addLog('🚀 콘텐츠 생성 시뮬레이션 시작', 'info');
            currentIndex = 0;
            
            const allPages = [];
            menuData.menus.forEach(menu => {
                menu.submenus.forEach(submenu => {
                    allPages.push({ menu, submenu });
                });
            });
            
            console.log(`📋 총 ${allPages.length}개 페이지 생성 예정`);
            addLog(`📋 총 ${allPages.length}개 페이지 생성 예정`, 'info');
            
            simulationInterval = setInterval(async () => {
                console.log(`🔄 페이지 ${currentIndex + 1}/${allPages.length} 처리 중`);
                
                if (currentIndex >= allPages.length) {
                    stopSimulation();
                    addLog('✅ 모든 페이지 생성 완료!', 'success');
                    return;
                }
                
                const { menu, submenu } = allPages[currentIndex];
                try {
                    await simulatePageGeneration(menu, submenu);
                    currentIndex++;
                    
                    updateContentGrid();
                    updateStats();
                } catch (error) {
                    console.error('페이지 생성 오류:', error);
                    addLog(`❌ 페이지 생성 오류: ${error.message}`, 'error');
                }
            }, 2000); // 2초마다 실행
        }
        
        // 페이지 생성 시뮬레이션
        async function simulatePageGeneration(menu, submenu) {
            const pageId = `${menu.id}/${submenu.id}`;
            addLog(`🎨 생성 중: ${menu.koreanTitle} > ${submenu.koreanTitle}`, 'info');
            
            try {
                // 메인 앱의 실제 콘텐츠 데이터 가져오기
                const realContent = getRealContentData(menu.id, submenu.id);
                
                if (realContent) {
                    // 이화여대 템플릿 HTML 생성
                    const htmlContent = generateEwhaTemplate(menu, submenu, realContent);
                    
                    // ContentStorage에 저장
                    const result = storage.storeGeneratedContent(pageId, {
                        title: realContent.title,
                        subtitle: realContent.subtitle,
                        mainContent: realContent.content,
                        features: realContent.features,
                        processingTime: Math.floor(Math.random() * 5) + 2,
                        metadata: {
                            menuId: menu.id,
                            submenuId: submenu.id,
                            pageType: 'generated',
                            generatedAt: new Date().toISOString()
                        }
                    });
                    
                    // 생성된 HTML을 저장소에 직접 추가
                    if (result && storage.generatedContent.has(pageId)) {
                        const savedContent = storage.generatedContent.get(pageId);
                        savedContent.content.htmlContent = htmlContent;
                        storage.generatedContent.set(pageId, savedContent);
                    }
                    
                    // 미리보기 업데이트
                    document.getElementById('preview-frame').srcdoc = htmlContent;
                    
                    addLog(`✅ 저장 완료: ${menu.koreanTitle} > ${submenu.koreanTitle}`, 'success');
                } else {
                    addLog(`⚠️ 콘텐츠 데이터 없음: ${pageId}`, 'warning');
                }
            } catch (error) {
                console.error('페이지 생성 오류:', error);
                addLog(`❌ 저장 실패: ${pageId} - ${error.message}`, 'error');
            }
        }
        
        // 시뮬레이션 중지
        function stopSimulation() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
                addLog('⏹️ 시뮬레이션 중지됨', 'warning');
            }
        }
        
        // 모두 초기화
        function clearAll() {
            stopSimulation();
            if (storage) {
                storage.clearAllContent();
                addLog('🗑️ 모든 콘텐츠 삭제됨', 'warning');
                updateContentGrid();
                updateStats();
            }
        }
        
        // 리뷰 모드 진입
        function enterReviewMode() {
            addLog('👁️ 리뷰 모드 활성화', 'info');
            
            // 저장된 콘텐츠 확인
            let savedCount = 0;
            menuData.menus.forEach(menu => {
                menu.submenus.forEach(submenu => {
                    const pageId = `${menu.id}/${submenu.id}`;
                    const content = storage.getGeneratedContent(pageId);
                    if (content) {
                        savedCount++;
                        addLog(`✅ 리뷰 가능: ${menu.koreanTitle} > ${submenu.koreanTitle}`, 'success');
                    }
                });
            });
            
            addLog(`총 ${savedCount}개 페이지 리뷰 가능`, 'info');
            
            // 첫 번째 저장된 페이지를 미리보기로 표시
            if (savedCount > 0) {
                for (const menu of menuData.menus) {
                    for (const submenu of menu.submenus) {
                        const pageId = `${menu.id}/${submenu.id}`;
                        const content = storage.getGeneratedContent(pageId);
                        if (content && content.content && content.content.htmlContent) {
                            document.getElementById('preview-frame').srcdoc = content.content.htmlContent;
                            addLog(`🔍 미리보기: ${menu.koreanTitle} > ${submenu.koreanTitle}`, 'info');
                            return;
                        }
                    }
                }
            }
        }
        
        // 콘텐츠 그리드 업데이트
        function updateContentGrid() {
            const grid = document.getElementById('content-grid');
            grid.innerHTML = '';
            
            menuData.menus.forEach(menu => {
                menu.submenus.forEach(submenu => {
                    const pageId = `${menu.id}/${submenu.id}`;
                    const content = storage ? storage.getGeneratedContent(pageId) : null;
                    
                    const card = document.createElement('div');
                    card.className = 'card';
                    
                    const status = content ? 'completed' : 'waiting';
                    const statusText = content ? '생성됨' : '대기중';
                    const statusClass = content ? 'completed' : 'waiting';
                    
                    card.innerHTML = `
                        <h3>${menu.koreanTitle} > ${submenu.koreanTitle}</h3>
                        <p>페이지 ID: ${pageId}</p>
                        <span class="status ${statusClass}">${statusText}</span>
                        ${content ? `<p style="font-size: 0.75rem; color: #059669;">✅ 콘텐츠 저장됨</p>` : ''}
                    `;
                    
                    // 클릭 시 미리보기
                    if (content && content.content && content.content.htmlContent) {
                        card.style.cursor = 'pointer';
                        card.addEventListener('click', () => {
                            document.getElementById('preview-frame').srcdoc = content.content.htmlContent;
                            addLog(`🔍 미리보기: ${menu.koreanTitle} > ${submenu.koreanTitle}`, 'info');
                        });
                    }
                    
                    grid.appendChild(card);
                });
            });
        }
        
        // 통계 업데이트
        function updateStats() {
            if (!storage) return;
            
            let completedCount = 0;
            let storedCount = 0;
            let reviewableCount = 0;
            
            menuData.menus.forEach(menu => {
                menu.submenus.forEach(submenu => {
                    const pageId = `${menu.id}/${submenu.id}`;
                    const content = storage.getGeneratedContent(pageId);
                    if (content) {
                        completedCount++;
                        storedCount++;
                        if (content.content && (content.content.htmlContent || content.content.title)) {
                            reviewableCount++;
                        }
                    }
                });
            });
            
            document.getElementById('completed-pages').textContent = completedCount;
            document.getElementById('stored-content').textContent = storedCount;
            document.getElementById('reviewable').textContent = reviewableCount;
        }
        
        // 저장소 디버그
        function showStorageDebug() {
            if (!storage) {
                addLog('❌ 저장소가 초기화되지 않음', 'error');
                return;
            }
            
            addLog('===== 저장소 디버그 정보 =====', 'info');
            
            const allContent = storage.getAllGeneratedContent();
            addLog(`총 저장된 페이지: ${allContent.size}개`, 'info');
            
            allContent.forEach((content, pageId) => {
                addLog(`📄 ${pageId}:`, 'info');
                addLog(`  - 제목: ${content.content?.title || 'N/A'}`, 'info');
                addLog(`  - 타임스탬프: ${content.timestamp}`, 'info');
                addLog(`  - HTML 콘텐츠: ${content.content?.htmlContent ? '있음' : '없음'}`, 'info');
            });
        }
        
        // 로그 추가
        function addLog(message, type = 'info') {
            const log = document.getElementById('simulation-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
    </script>
</body>
</html>